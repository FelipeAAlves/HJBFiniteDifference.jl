\documentclass[english]{article}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{esint}
\usepackage{babel}
\begin{document}

\section{Derivation}
HJB is
$$0 = \rho \theta V_t(\frac{C_t^{\frac{1-\gamma}{\theta}}}{((1-\gamma)V_t)^{\frac{1}{\theta}}}-1) + \frac{E[dV_t]}{dt}$$
Let's define $G_t$ such that
$$V_t = \frac{C_t^{1-\gamma}}{1-\gamma} G_t$$
By Ito, 
$$0 = \rho\theta(G_t^{1-\frac{1}{\theta}}-G_t)   +  G_t E\frac{\frac{dC_t^{1-\gamma}}{C_t^{1-\gamma}}}{dt} + E\frac{dG_t}{dt} + E\frac{dG_t\frac{dC_t^{1-\gamma}}{C_t^{1-\gamma}}}{dt}$$
Denoting $\mu_{C}$ and $\sigma_{C}$ the geometric drift of $C_t$, we have
\begin{align*}
	\frac{dC_{t}^{1-\gamma}}{C_{t}^{1-\gamma}}=((1-\gamma)\mu_{C}-\frac{1}{2}(1-\gamma)\gamma\sigma^{2}_{C})dt + (1-\gamma)\sigma_{C}dW_t
\end{align*}
Injecting this expression into HJB and denoting $\mu_G, \sigma_G$ the arithmetic drift and volatility of $G_t$
$$0 = \rho \theta (G_t^{1-\frac{1}{\theta}}-G_t)  + G_t ((1-\gamma) \mu_{C} - \frac{1}{2}(1-\gamma)\gamma\sigma_{C}'\sigma_{C}) +  \mu_G + \sigma_G'(1-\gamma)\sigma_{C}$$

\section{Long run risk model}

\subsection{Derivation}
We now assume that the evolution of consumption is driven by two state variables $\mu_{t}$ and $\sigma_{t}$:
\begin{align*}
	\frac{dC_{t}}{C_{t}} & =  \mu_{t}dt+\nu_{D}\sqrt{\sigma_{t}}dZ_{t}\\
	d\mu_{t} & =  \kappa_{\mu}(\bar{\mu}-\mu_{t})dt+\nu_{\mu}\sqrt{\sigma_{t}}dZ_{t}^{\mu}\\
	d\sigma_{t} & =  \kappa_{\sigma}(1-\sigma_{t})dt+\nu_{\sigma}\sqrt{\sigma_{t}}dZ_{t}^{\sigma}
\end{align*}
We write $G_t = G(\mu, \sigma)$ and we get the PDE
\begin{align*}
	0&= \rho \theta[G^{1-\frac{1}{\theta}}- G]+G((1-\gamma)\mu-\frac{1}{2}(1-\gamma)\gamma\nu_D^2\sigma)\\
	&+ \kappa_{\mu}(\bar{\mu}-\mu)\frac{\partial G}{\partial\mu}+  \kappa_{\sigma}(1-\sigma)\frac{\partial G}{\partial\sigma}\\
	&+\frac{1}{2}\nu_{\mu}^{2}\sigma\frac{\partial^{2}G}{\partial\mu^{2}}+\frac{1}{2}\nu_{\sigma}^{2}\sigma \frac{\partial^{2}G}{\partial\sigma^{2}}
\end{align*}
Boundary coundition  = reflectiving barrier
\begin{align*}
	\partial_\mu G(\underline{u}, \sigma) &= 0  \\
	\partial_\mu G(\overline{u}, \sigma) &= 0 \\
	\partial_\sigma G(u, \underline{\sigma}) &= 0  \\
	\partial_\sigma G(u, \overline{\sigma}) &= 0 
\end{align*}
I think the best way to incorporate these boundary conditions is to adopt an upwinding scheme. The upwinding scheme says to approximate the first derivative by the forward difference when the drift of a state variable is positive, and by the backward difference when the drift of a state variable is negative.
\begin{align*}
	0&= \rho \theta[(G_{ij})^{1-\frac{1}{\theta}}- G_{ij}]+G_{ij}((1-\gamma)\mu_i-\frac{1}{2}(1-\gamma)\gamma\nu_D^2\sigma_j)\\
	&+\kappa_{\mu_i}(\bar{\mu}-\mu_i)^+\frac{G_{i+1, j}-G_{i, j}}{\Delta \mu} +\kappa_{\mu_i}(\bar{\mu}-\mu_i)^-\frac{G_{i, j}-G_{i-1, j}}{\Delta \mu}\\
	&+\kappa_{\sigma_j}(1-\sigma_j)^+\frac{G_{i, j+1}-G_{i,j}}{\Delta \sigma} +\kappa_{\sigma_j}(1-\sigma_j)^-\frac{G_{i, j}-G_{i,j-1}}{\Delta \sigma}\\
	&+\frac{1}{2}\nu_{\mu_i}^{2}\sigma_j\frac{G_{i+1, j} - 2 G_{i, j} + G_{i-1, j}}{(\Delta\mu)^2}+\frac{1}{2}\nu_{\sigma_j}^{2}\sigma_j\frac{G_{i, j+1} - 2 G_{i, j} + G_{i, j-1}}{(\Delta\sigma)^2}
\end{align*}

At the frontier of the state space, the second order derivative uses the value of $G$ at nodes not on the grid (``ghost nodes''): set the value of these nodes to the value of nodes at the frontier.


Denote $y$ the vector of  $(G_{ij})_{1 \leq i,j\leq n})$. The scheme can be solved in two ways
\begin{itemize}
	\item Use a non linear solver to solve $F(y) = 0$, using for instance the Powell or Newton methods. Both methods require to specify the Jacobian of $F$. 
	\item Use a ODE solver to solve $F(y) = \dot{y}$. The solution when $T\rightarrow +\infty$ is the solution of the PDE. Some MATLAB solvers like \printt{ode23s} also accept  the Jacobian of $F$ as an imput. This makes the solution faster, but this requires to program a little bit more.
\end{itemize}

Both methods require an initial guess. Use the value function for the stationary problem $\sigma = 1$ and $\mu = \overline{\mu}$
			
\subsection{Comparison}

\begin{tabular}{|c|c|c|c|c|c|}
	\hline 
	Name & BY04 & BY04 & This paper & This paper & Link
	\\
	\hline 
	\hline 
	mean growth rate & $\mu$ & 0.0015 & $\bar{\mu}$ & 0.0015 & $\mu=\bar{\mu}$
	\\
	\hline 
	mean volatility & $\sigma^{2}$ & 0.00006084 & $\nu_{D}$ & 0.0078 & $\sqrt{\sigma^{2}}=\nu_{D}$
	\\
	\hline 
	growth persistence & $\rho$ & 0.979 & $\kappa_{\mu}$ & 0.0212 & $ - \log(\rho) = \kappa_\mu$ 
	\\
	\hline 
	volatility persistence & $\nu_{1}$ & 0.987 & $\kappa_{\sigma}$ & 0.0131 & $-\log\left(\nu_{1}\right)=\kappa_{\sigma}$
	\\
	\hline 
	growth rate volatility & $\varphi_{e}$ & 0.044 & $\nu_{\mu}$ & 0.0003432 & $\varphi_{e}\times\sqrt{\sigma^{2}}=\nu_{\mu}$
	\\
	\hline 
	volatility volatility & $\sigma_{w}$ & 0.0000023 & $\nu_{\sigma}$ & 0.0378 & $\sigma_{w}/\sigma^{2}=\nu_{\sigma}$
	\\
	\hline 
	time discount & $\delta$ & 0.998 & $\rho$ & 0.002 & $-\log\left(\delta\right)=\rho$
	\\
	\hline 
	RRA & $1-\gamma$(RRA) & 7.5 or 10 & $1-\gamma$ & -6.5 or -9 & $1-\text{RRA}=1-\gamma$
	\\
	\hline 
	IES & $\psi$ & 1.5 & $\psi$ & 1.5 & $\psi = \psi$
	\\
	\hline
\end{tabular}
Also,  $\theta = (1-\gamma)/(1- 1/\psi)$ = -19.50 or -27.


Let's express the  wealth to consumption ratio $k_t$ in term of state variables.
$$V = G_tk_t^{\gamma - 1}\frac{W^{1-\gamma}}{(1-\gamma)}$$
FOC for consumption can be written
$$k_t^{-1} = \rho^{\psi} k_t^{\psi - 1}G_t^\frac{1-\psi}{1-\gamma}$$
General equilibrium gives
$$ k_t = \rho^{-1} G_t^{1/\theta}$$
Bansal Yaron find
\begin{align*}
	k_t &\propto A_1 \mu_t + A_2 \nu_D^2\sigma_t\\
	A1 &= \frac{1-\frac{1}{\psi}}{1-0.997 e^{-\kappa_\mu}}\\
	A2 &= 0.5\theta\frac{(1 - \frac{1}{\psi})^2 + (A_1  0.997 \frac{\nu_\mu}{\nu_D})^2}{1-0.997e^{-\kappa_\sigma}}
\end{align*}

\section{Solving HJB}
Suppose we have a function for the sdf
$$\frac{\rho}{1-\frac{1}{\psi}}&=  -\frac{\rho^\psi}{1-\psi}\xi^{1-\psi}  +r_f + (\frac{\pi}{\gamma} - \frac{\gamma-1}{\gamma}\sigma^\xi)\pi +\mu_{\xi}-\frac{\gamma}{2}( (\frac{\pi}{\gamma} - \frac{\gamma-1}{\gamma}\sigma^\xi)^2 +\sigma^2_\xi -2(1-\gamma)(\frac{\pi}{\gamma} - \frac{\gamma-1}{\gamma}\sigma^\xi)\sigma_\xi)$$


\end{document}